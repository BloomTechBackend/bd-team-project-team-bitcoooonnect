{"ast":null,"code":"import \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/web.atob.js\";\nimport \"core-js/modules/web.dom-exception.constructor.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/web.dom-exception.to-string-tag.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.concat.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport axios from 'axios';\nexport default {\n  name: 'MyPortfolio',\n  props: {\n    msg: String,\n    auth: String,\n    email: String\n  },\n  data: function data() {\n    return {\n      coins: {},\n      //Changes Here\n      ourCoinList: new Map(),\n      state: \"ready\",\n      newCoin: {\n        name: null,\n        amount: null\n      },\n      userEmail: \"\",\n      url: \"https://t3d210uhn7.execute-api.us-east-2.amazonaws.com/test/portfolio?emailId=\".concat(this.email)\n    };\n  },\n  mounted: function mounted() {\n    this.state = \"loading\";\n    this.getEmail();\n    this.getCoin(); //Changes Here\n\n    this.getOurCoinList();\n  },\n  computed: {\n    portfolio: function portfolio() {\n      var networth = 0; // this.state = \"loading\";\n\n      var size = Object.keys(this.coins).length;\n      console.log(size);\n\n      if (size === 0) {\n        console.log(\"empty portfolio\");\n        return;\n      }\n\n      for (var myCoin in this.coins) {\n        networth += this.coins[myCoin].value;\n      }\n\n      return networth.toFixed(2);\n    }\n  },\n  methods: {\n    getCoin: function getCoin() {\n      var _this = this;\n\n      if (location.href.split('#').length === 1) {\n        return null;\n      }\n\n      this.state = \"loading\";\n      axios.get(this.url, {\n        headers: {\n          \"Authorization\": this.auth\n        }\n      }).then(function (response) {\n        if (response.data.errorMessage === \"java.lang.NullPointerException\") {\n          return _this.createUser();\n        }\n\n        _this.coins = response.data.coins;\n        _this.state = \"ready\";\n      });\n    },\n    getEmail: function getEmail() {\n      if (location.href.split('#').length === 1) {\n        return null;\n      }\n\n      var idTokenWithEquals = location.href.split('#')[1].split('&')[0];\n      var COGNITO_ID_TOKEN = idTokenWithEquals.split('=')[1];\n      COGNITO_ID_TOKEN = this.parseJwt(COGNITO_ID_TOKEN);\n      this.userEmail = COGNITO_ID_TOKEN.email;\n    },\n    parseJwt: function parseJwt(token) {\n      var base64Url = token.split('.')[1];\n      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n      var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(''));\n      return JSON.parse(jsonPayload);\n    },\n    createUser: function createUser() {\n      var _this2 = this;\n\n      this.state = \"loading\";\n      axios.post(this.url, {}, {\n        headers: {\n          'Authorization': this.auth\n        }\n      }).then(function (res) {\n        try {\n          _this2.info = res.data;\n\n          _this2.getCoin();\n        } catch (error) {\n          alert(\"API offline: UPDATE\");\n          _this2.state = \"ready\";\n        }\n      });\n    },\n    updateCoin: function updateCoin() {\n      var _this3 = this;\n\n      if (this.newCoin.name === null || this.newCoin.amount === null) {\n        console.log(\"empty updatecoin\");\n        return;\n      }\n\n      if (!this.ourCoinList.get(this.newCoin.name)) {\n        console.log(\"newCoin not present\");\n        return;\n      } //\n\n\n      this.state = \"loading\";\n      var extraParams = \"&coinId=\".concat(this.newCoin.name, \"&amount=\").concat(this.newCoin.amount);\n      axios.put(this.url + extraParams, {}, {\n        headers: {\n          'Authorization': this.auth\n        }\n      }).then(function (res) {\n        try {\n          _this3.info = res.data;\n\n          _this3.getCoin();\n        } catch (error) {\n          alert(\"API offline: UPDATE\");\n          _this3.state = \"ready\";\n        }\n      });\n    },\n    getOurCoinList: function getOurCoinList() {\n      var _this4 = this;\n\n      if (location.href.split('#').length === 1) {\n        return null;\n      }\n\n      this.state = \"loading\";\n      axios.get('https://t3d210uhn7.execute-api.us-east-2.amazonaws.com/test/graball', {}).then(function (res) {\n        try {\n          for (var i = 0; i < res.data.body.Items.length; i++) {\n            var item = res.data.body.Items[i].id;\n\n            _this4.ourCoinList.set(item, true);\n          }\n        } catch (error) {\n          alert(\"API getOurCoinList offline\");\n          _this4.state = \"ready\";\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AAEA;AACAA,qBADA;AAEAC;AACAC,eADA;AAEAC,gBAFA;AAGAC;AAHA,GAFA;AAQAC;AACA;AACAC,eADA;AAEA;AACAC,4BAHA;AAIAC,oBAJA;AAKAC;AACAT,kBADA;AAEAU;AAFA,OALA;AASAC,mBATA;AAUAC;AAVA;AAYA,GArBA;AAsBAC,SAtBA,qBAsBA;AACA;AACA;AACA,mBAHA,CAIA;;AACA;AACA,GA5BA;AA6BAC;AACAC;AACA,uBADA,CAEA;;AACA;AACAC;;AACA;AACAA;AACA;AACA;;AAEA;AACAC;AACA;;AAGA;AACA;AAjBA,GA7BA;AAgDAC;AACAC,WADA,qBACA;AAAA;;AACA;AACA;AACA;;AACA;AACAC,YACAC,GADA,CACA,QADA,EAEA;AAAAC;AACA;AADA;AAAA,OAFA,EAKAC,IALA,CAKA;AACA;AACA;AACA;;AACA;AACA;AACA,OAXA;AAaA,KAnBA;AAoBAC,YApBA,sBAoBA;AACA;AACA;AACA;;AACA;AACA;AACAC;AAEA;AAEA,KA9BA;AA+BAC,YA/BA,oBA+BAC,KA/BA,EA+BA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEAC,IAFA,CAEA,EAFA;AAIA;AACA,KAvCA;AAwCAC,cAxCA,wBAwCA;AAAA;;AACA;AACAT;AACAE;AACA;AADA;AADA,SAIAC,IAJA,CAIA;AACA;AACA;;AACA;AACA,SAHA,CAGA;AACAO;AACA;AACA;AACA,OAZA;AAaA,KAvDA;AAwDAC,cAxDA,wBAwDA;AAAA;;AACA;AACAf;AACA;AACA;;AAEA;AACAA;AACA;AACA,OATA,CAWA;;;AACA;AACA;AACAI;AACAE;AACA;AADA;AADA,SAIAC,IAJA,CAIA;AACA;AACA;;AACA;AACA,SAHA,CAGA;AACAO;AACA;AACA;AACA,OAZA;AAaA,KAnFA;AAoFAE,kBApFA,4BAoFA;AAAA;;AACA;AACA;AACA;;AACA;AAEAZ,2FACAG,IADA,CACA;AACA;AACA;AACA;;AACA;AACA;AAEA,SANA,CAMA;AACAO;AACA;AACA;AACA,OAZA;AAaA;AAvGA;AAhDA","names":["name","props","msg","auth","email","data","coins","ourCoinList","state","newCoin","amount","userEmail","url","mounted","computed","portfolio","console","networth","methods","getCoin","axios","get","headers","then","getEmail","COGNITO_ID_TOKEN","parseJwt","token","join","createUser","alert","updateCoin","getOurCoinList"],"sourceRoot":"src/components","sources":["Portfolio.vue"],"sourcesContent":["<template>\n  <div>\n    <h1>{{ msg }}</h1>\n    <body>\n        <a v-if=\"email === undefined || email === null\" \n        href=\"https://my-coins.auth.us-east-2.amazoncognito.com/login?client_id=n2l1crskuigpqp3lrbsj8r7nj&response_type=token&scope=email+openid&redirect_uri=https://main.d1cm820nfbsmxw.amplifyapp.com/\">Login</a>\n        \n        <div v-else>\n            <div>\n                <div></div>\n                <input v-model=\"newCoin.name\" placeholder=\"coin name\">\n                <input v-model=\"newCoin.amount\" type=\"text\" placeholder=\"amount\">\n                <input class=\"coin-not-found\" @click=\"updateCoin\" type=\"button\" :value=\"'Coin Not Found' || 'Update Portfolio'\">\n\n            </div>\n\n            <div>\n                <h2>Total Portfolio Value: {{portfolio || 0}} </h2>\n            </div>\n\n            <div class=\"container\">\n                <table>\n                    <thead>\n                        <tr>\n                            <th>Coin</th>\n                            <th>Amount</th>\n                            <th>Price</th>\n                            <th>Value</th>\n                        </tr>\n                    </thead>\n                    <tbody v-if=\"state === 'ready'\">\n                        <tr v-for=\"(coin, value) in coins\" :key=\"coin.name\">\n                            <td>{{value}}</td>\n                            <td>{{coin.amount}}</td>\n                            <td>${{coin.price.toFixed(2)}}</td>\n                            <td>${{coin.value.toFixed(2)}}</td>\n                        </tr>\n                    </tbody>\n                </table>  \n                <div v-if=\"state === 'loading'\">\n                    <p>loading data...</p>\n                </div>\n            </div>\n        </div>\n    </body>\n  </div>\n</template>\n\n<script>\n\nimport axios from 'axios';\n\nexport default {\n  name: 'MyPortfolio',\n  props: {\n    msg: String,\n    auth: String,\n    email: String\n  },\n\n  data: function() {\n      return {\n          coins: {},\n          //Changes Here\n          ourCoinList: new Map(),\n          state: \"ready\",\n          newCoin: {\n              name: null,\n              amount: null,\n          },\n          userEmail: \"\",\n          url: `https://t3d210uhn7.execute-api.us-east-2.amazonaws.com/test/portfolio?emailId=${this.email}`\n      }\n  },\n  mounted () {\n      this.state = \"loading\"\n      this.getEmail();\n      this.getCoin();\n      //Changes Here\n      this.getOurCoinList();\n  },\n  computed: {\n      portfolio: function() {\n        let networth = 0; \n        // this.state = \"loading\";\n        let size = Object.keys(this.coins).length\n        console.log(size)\n        if (size === 0) {\n            console.log(\"empty portfolio\");\n            return;\n        }\n\n        for (const myCoin in this.coins) {\n            networth += this.coins[myCoin].value;\n        }\n\n\n        return networth.toFixed(2);\n      },\n  },\n  methods: {\n    getCoin() {\n      if (location.href.split('#').length === 1) {\n          return null;\n      }\n      this.state = \"loading\"\n      axios\n        .get(this.url,\n        {headers: {\n            \"Authorization\": this.auth\n        }})\n        .then(response => {\n           if (response.data.errorMessage === \"java.lang.NullPointerException\") {\n             return this.createUser();\n            }\n            this.coins = response.data.coins\n            this.state = \"ready\"\n        }\n        )\n    },\n    getEmail() {\n        if (location.href.split('#').length === 1) {\n            return null;\n        } \n        var idTokenWithEquals = (location.href.split('#')[1]).split('&')[0];\n        var COGNITO_ID_TOKEN = idTokenWithEquals.split('=')[1];\n        COGNITO_ID_TOKEN = this.parseJwt(COGNITO_ID_TOKEN);\n\n        this.userEmail = COGNITO_ID_TOKEN.email \n\n    },\n    parseJwt(token) {\n        var base64Url = token.split('.')[1];\n        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n\n        return JSON.parse(jsonPayload);\n    },\n    createUser() {\n        this.state = \"loading\";\n        axios.post(this.url, {}, {\n        headers: {\n            'Authorization': this.auth,\n        }\n        }).then((res) => {\n            try {\n                this.info = res.data;\n                this.getCoin();\n            } catch (error) { \n                alert(\"API offline: UPDATE\");\n                this.state = \"ready\";\n            }\n        })\n    },\n    updateCoin() {\n        if (this.newCoin.name === null || this.newCoin.amount === null) {\n            console.log(\"empty updatecoin\");\n            return;\n        }\n\n        if (!this.ourCoinList.get(this.newCoin.name)) {\n            console.log(\"newCoin not present\");\n            return;\n        }\n\n        //\n        this.state = \"loading\";\n        let extraParams = `&coinId=${this.newCoin.name}&amount=${this.newCoin.amount}`\n        axios.put(this.url + extraParams, {}, {\n        headers: {\n            'Authorization': this.auth,\n        }\n        }).then((res) => {\n            try {\n                this.info = res.data;\n                this.getCoin();\n            } catch (error) { \n                alert(\"API offline: UPDATE\");\n                this.state = \"ready\";\n            }\n        })\n   },\n    getOurCoinList() {\n        if (location.href.split('#').length === 1) {\n            return null;\n        } \n        this.state = \"loading\";\n\n        axios.get('https://t3d210uhn7.execute-api.us-east-2.amazonaws.com/test/graball', {}\n        ).then((res) => {\n            try {\n                for (let i =0;i<res.data.body.Items.length;i++){\n                    var item = res.data.body.Items[i].id;\n                    this.ourCoinList.set(item, true)\n                }\n                \n            } catch (error) { \n                alert(\"API getOurCoinList offline\");\n                this.state = \"ready\";\n            }\n        })\n   },\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n@import url('~simpledotcss/simple.min.css');\n\n.margin-standard {\n    margin-right: 20px;\n}\n.coin-not-found {\n    color: red;\n    background-color: black;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}